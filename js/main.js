let unlockSlider,rankSlider,unitData=[],seenUnitNames=new Set;const excludeOthers=new Set(["The Ridgy-Didge","Promotional","SpecOps CenterPromotional","Mercenary Vault","Missile Silo","The Way to a Bigfoot's Heart...","Research Lab","Drop fromAncient ConstructorExperiment X17","Drop fromSpiderwasp Queen","Drop fromGoliath Tank","SCRAM, For Kids","The Frontier Jubilee Charity Drive","Boss Strike","Arena Challenge 1"]);function updateOwnedCheckboxes(e){$("#unitTable tbody tr:visible .owned-checkbox").each(function(){if($(this).prop("checked")!==e){const t=$(this).data("unit");updateTracking(t,"owned",e)}}),drawTable()}function updateRankedCheckboxes(e){$("#unitTable tbody tr:visible .ranked-checkbox").each(function(){if($(this).prop("checked")!==e){const t=$(this).data("unit"),n=$(this).data("rank");updateTracking(t,"ranked",e,n)}}),drawTable()}function isUnique(e){return!seenUnitNames.has(e)&&(seenUnitNames.add(e),!0)}function drawTable(){document.getElementById("torank-count").textContent=`${countTotalRanksTodo()}`,document.getElementById("owned-count").textContent=`${countOwnedUnits()}`,document.getElementById("ranked-count").textContent=`${countRankedUnits()}`,table.draw()}function clearFilters(e=!1){const t=["building_filter","other_filter","category_filter","rank-filter","nanopods_filter","ranked_filter","owned_filter"];for(const e of t){const t=document.getElementById(e);t&&(t.multiple?t.value=null:t.value="all",M.FormSelect.getInstance(t)?.destroy(),M.FormSelect.init(t))}unlockSlider?.noUiSlider&&unlockSlider.noUiSlider.set([0,70]),rankSlider?.noUiSlider&&rankSlider.noUiSlider.set([0,100]),$("#filter-unique").prop("checked",!1),!1===e&&table.draw()}function populateFilters(){const e=(e,t)=>{const n=document.getElementById(e);for(const e of t){const t=document.createElement("option");t.value=e,t.textContent=e||"(none)",n.appendChild(t)}},t=e=>[...new Set(unitData.map(t=>t[e]).filter(e=>void 0!==e))].sort((e,t)=>e.localeCompare(t));e("building_filter",t("building_requirement")),e("other_filter",t("other_requirements")),e("category_filter",t("category"))}function getCurrentFilters(){return{building_filter:$("#building_filter").val(),other_filter:$("#other_filter").val(),category_filter:$("#category_filter").val(),nanopods_filter:$("#nanopods_filter").val(),rank_filter:$("#rank-filter").val(),filter_owned:$("#owned_filter").val(),ranked_filter:$("#ranked_filter").val(),unlock_level_range:unlockSlider.noUiSlider.get().map(Number),rank_slider:rankSlider.noUiSlider.get().map(Number),username:$("#username").prop("value")}}function setFilters(e){e&&($("#building_filter").val(e.building_filter).formSelect(),$("#other_filter").val(e.other_filter).formSelect(),$("#category_filter").val(e.category_filter).formSelect(),$("#nanopods_filter").val(e.nanopods_filter).formSelect(),$("#rank-filter").val(e.rank_filter).formSelect(),$("#owned_filter").val(e.filter_owned).formSelect(),$("#ranked_filter").val(e.ranked_filter).val()||$("#ranked_filter").prop("selectedIndex",0),$("#username").val(e.username),e.unlock_level_range&&2===e.unlock_level_range.length&&unlockSlider.noUiSlider.set(e.unlock_level_range),e.rank_slider&&2===e.rank_slider.length&&(rankSlider.noUiSlider.set(e.rank_slider),rankSlider.noUiSlider.set(e.rank_slider)))}function filterTable(){table&&"function"==typeof table.draw?table.draw():console.error("Unable to draw table")}function highlight(e){e.addClass("highlight-change"),setTimeout(()=>e.removeClass("highlight-change"),500)}function getUserName(){let e=$("#username").val();return e||"unknown"}document.addEventListener("DOMContentLoaded",function(){unlockSlider=document.getElementById("unlock-level-slider"),noUiSlider.create(unlockSlider,{start:[0,49],connect:!0,step:1,tooltips:!0,stateSave:!0,range:{min:0,max:70},format:{to:e=>Math.round(e),from:e=>Number(e)}}),rankSlider=document.getElementById("unlock-rank-slider"),noUiSlider.create(rankSlider,{start:[0,49],connect:!0,step:1,tooltips:!0,stateSave:!0,range:{min:0,max:70},format:{to:e=>Math.round(e),from:e=>Number(e)}}),fetch("data/unit_data.json").then(e=>e.json()).then(e=>{unitData=e,populateFilters(),initTable(e),$("select").formSelect(),$("#rank-filter").formSelect(),$("select").on("change",filterTable);const t=document.getElementById("unlock-range-display");unlockSlider.noUiSlider.on("update",function(e){t.textContent=`Level: ${e[0]} - ${e[1]}`,table.draw()});const n=document.getElementById("unlock-rank-display");rankSlider.noUiSlider.on("update",function(e){n.textContent=`Unlock rank: ${e[0]} - ${e[1]}`,table.draw()}),$("#unitTable").on("change",".owned-checkbox, .ranked-checkbox",function(){seenUnitNames=new Set,table.draw()}),$.fn.dataTable.ext.search.push(function(e,t,n){0===n&&(seenUnitNames=new Set);const r=unitData[n];if(!r)return!1;let[l,o]=[1,100];unlockSlider?.noUiSlider&&([l,o]=unlockSlider.noUiSlider.get().map(Number));let[a,i]=[1,100];rankSlider?.noUiSlider&&([a,i]=rankSlider.noUiSlider.get().map(Number));let d=r.unlock_level,c=r.pre_req_rank;if((isNaN(d)||null==d)&&(d=1),(isNaN(c)||null==c)&&(c=1),d<l||d>o)return!1;if(c<a||c>i)return!1;const u=$("#rank-filter").val();if(u?.length&&!u.includes(r.rank))return!1;const s=e=>Array.from(document.getElementById(e).selectedOptions).map(e=>e.value),m=s("building_filter"),f=s("other_filter"),k=s("category_filter"),g=document.getElementById("nanopods_filter").value,h=0===m.length||m.includes(r.building_requirement),p=0===f.length||f.includes(r.other_requirements),S=0===k.length||k.includes(r.category),_="all"===g||"true"===g&&r.requires_nanopods||"false"===g&&!r.requires_nanopods,b=getStoredTrackingData()[`${r.unit_name}::${r.rank}`]||{},v=document.getElementById("owned_filter").value,y="all"===v||"yes"===v&&b.owned||"no"===v&&!b.owned,w=document.getElementById("ranked_filter").value,E="all"===w||"yes"===w&&b.ranked||"no"===w&&!b.ranked;return!($("#filter-unique").prop("checked")&&h&&p&&S&&_&&y&&E&&!isUnique(r.unit_name))&&(h&&p&&S&&_&&y&&E)}),drawTable()})}),document.getElementById("currentVersionBtn").addEventListener("click",()=>{unlockSlider.noUiSlider.set([0,49]),rankSlider.noUiSlider.set([0,49]);const e=document.getElementById("other_filter");for(const t of e.options)t.selected=!1;for(const t of e.options)excludeOthers.has(t.value)||(t.selected=!0);M?.FormSelect&&(M.FormSelect.getInstance(e)?.destroy(),M.FormSelect.init(e)),table.draw()}),document.getElementById("themeToggle").addEventListener("change",function(){document.body.classList.toggle("dark-mode",this.checked)}),document.getElementById("exportData").addEventListener("click",exportData),document.getElementById("importDataBtn").addEventListener("click",()=>{document.getElementById("importData").click()}),document.getElementById("importData").addEventListener("change",function(e){importData(e.target.files[0])}),$("#owned-select-all").on("click",()=>updateOwnedCheckboxes(!0)),$("#owned-deselect-all").on("click",()=>updateOwnedCheckboxes(!1)),$("#ranked-select-all").on("click",()=>updateRankedCheckboxes(!0)),$("#ranked-deselect-all").on("click",()=>updateRankedCheckboxes(!1)),$("#filter-unique").on("change",()=>table.draw()),document.getElementById("clear-filters").addEventListener("click",()=>{clearFilters()}),document.getElementById("clear-all").addEventListener("click",()=>{localStorage.removeItem("unitTracking"),clearFilters(!0),$(".owned-checkbox, .ranked-checkbox").prop("checked",!1),$("#username").val(""),drawTable()});